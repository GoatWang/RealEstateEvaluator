{% load static %}

<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>RealEstateEvaluator</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="{% static 'evaluator/vendor/bootstrap/css/bootstrap.min.css' %}">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="{% static 'evaluator/vendor/font-awesome/css/font-awesome.min.css' %}">
    <!-- Fontastic Custom icon font-->
    <link rel="stylesheet" href="{% static 'evaluator/css/fontastic.css' %}">
    <!-- Google fonts - Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
    <!-- jQuery Circle-->
    <link rel="stylesheet" href="{% static 'evaluator/css/grasp_mobile_progress_circle-1.0.0.min.css' %}">
    <!-- Custom Scrollbar-->
    <link rel="stylesheet" href="{% static 'evaluator/vendor/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.css' %}">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="{% static 'evaluator/css/style.default.css' %}" id="theme-stylesheet' %}">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="{% static 'evaluator/css/custom.css' %}">
    <!-- Favicon-->
    <link rel="shortcut icon" href="{% static 'evaluator/img/favicon2.ico' %}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>

    <style>
        #id_map { height: 300px; }
        label{
          font-size:20px;
        }
        #id_topdiv{
          margin-top:30px;
        }
        #id_price_h2{
          font-size: 50px;
          align-content:center;
          color:rgb(255, 99, 132) ;
          text-align: center;
        }
        #background_div{
          background-image:url('{% static "evaluator/img/banner2.5.jpg" %}');
          background-repeat: no-repeat fixed;
          background-color:black;
          background-size: cover;
          width:100%;
        }  
        form label{
          font-size: 15px;  
        }
        form .text-small{
          font-size:13px;
        }
        form input{
          max-height:31.5px;
        }
        form select{
          max-height:31.5px;
        }
        .disc_stat_font{
          font-size: 55px;
        }
        .cls_nearest_obj_table{
          margin-top:10px;
        }
    </style>
      
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
  </head>
  <body>
    <div class="page">
      <!-- navbar-->
      <header class="header">
        <nav class="navbar">
          <div class="container-fluid">
            <div class="navbar-holder d-flex align-items-center justify-content-between">
              <div class="navbar-header">
                <a href="index.html" class="navbar-brand">
                  <div class="brand-text d-none d-md-inline-block"><span>Real Estate</span>&nbsp;&nbsp;<strong class="text-info">Evaluator</strong></div></a></div>
            </div>
          </div>
        </nav>
      </header>
      <!-- Counts Section -->

      <!-- Header Section-->
      <div class="container">
        <div class="py-5 text-center">
          <!-- <img class="d-block mx-auto mb-4" src="./index_files/bootstrap-solid.svg" alt="" width="72" height="72"> -->
          <span style="font-size:1.4cm; color:rgb(44, 143, 201);"><strong>REAL ESTATE EVALUATOR</strong></span>
          <p class="desc_p" style="color:rgb(0, 0, 0)"><strong>Real Estate Evaluator is a forecast AI model of the House Value via Hedonic Price Method and eXtreme Gradient Boosting<br>
            It helps achieve a cost reduction in the process and reduce the huge loss caused by evaluation mistakes</strong></p>
        </div>
        <div class="text-center">
          <span style="font-size:0.8cm; color:rgb(44, 143, 201);"><strong>Professional AI Solution</strong></span>
          <p class="desc_p">We use Hedonic Model to select the parameters which are statistically significant and estimate their partial effects,<br>
            then input the parameters to implement the eXtreme Gradient Boosting model to become more accurate in predicting house price.<br>
          The parameters are from various data sources including actual selling price property value reporting, relative supply of new building,<br>
            criminal location, income level at the village, electricity consumption rate and the parameters that generated through Google Place Search.</p>
        </div>
        <div class="text-center">
            <span style="font-size:0.8cm;color:rgb(44, 143, 201);"><strong>Incredible Accuracy</strong></span>
            <p class="desc_p">Compared with actual selling price, the Cross Validation presents<br>
              90% of testing data with less than 30% error<br>80% of testing data with less than 20% error<br>50% of testing data with less than 10% error<br><br></p>
        </div>
      </div>

      <div class='container-fluid' id='id_topdiv'>
        <div class='row d-flex align-items-md-stretch'>
            <div class="col-md-5">
              <div class="card">
                <div class="card-header d-flex align-items-center">
                  <h3>Retrieval Information: The House Data in Taipei</h3>
                </div>
                <div class="card-body">
                  <form class="form-horizontal">
                    <div class="line"></div>
                    <div class="form-group row">
                      <label class="col-sm-4 form-control-label">Address</label>
                      <div class="col-sm-8">
                        <input id="idAddressInput" type="text" class="form-control text-small" min="0" max="2000"><span class="text-small text-gray help-block-none">Please input in Chinese</span>
                      </div>
                    </div>

                    <div class="line"></div>
                    <div class="form-group row">
                      <label class="col-sm-4 form-control-label">Ping (Âù™)</label>
                      <div class="col-sm-8">
                        <input id="idPingInput" type="number" class="form-control text-small" min="0" max="2000"><span class="text-small text-gray help-block-none">Please input the range from 1 to 2000 Pings<br>Unit of measurement for area in Taiwan<br>1 square meter = 0.3025 Pings</span>
                      </div>
                    </div>
  
                    <div class="line"></div>
                    <div class="form-group row">
                      <label class="col-sm-4 form-control-label">Building Age</label>
                      <div class="col-sm-8">
                        <input id="idHouseAgeInput" type="number" class="form-control text-small" min="0" max="2000"><span class="text-small text-gray help-block-none">Please input the range from 0 to 100 years</span>
                      </div>
                    </div>
  
                    <div class="line"></div>
                    <div class="form-group row">
                      <label class="col-sm-4 form-control-label">Usage Type</label>
                      <div class="col-sm-8 mb-3">
                        <select id="idUsageSelect" name="usage" class="form-control text-small">
                          <option>For Living</option>
                          <option>For Business</option>
                          <option>Other</option>
                        </select>
                      </div>
                    </div>
  
                    <div class="line"></div>
                    <div class="form-group row">
                      <label class="col-sm-4 form-control-label">Building Type</label>
                      <div class="col-sm-8 mb-3">
                        <select id="idBuildingTypeSelect" name="building_type" class="form-control  text-small">
                          <option>1. Residential Building (Residential buildings with elevators, 11 floors or more)</option>
                          <option>2. Huaxia (Residential buildings with elevators, between 7th and 10th floor)</option>
                          <option>3. Apartment (Residential buildings without elevator, less than 6th floor)</option>
                          <option>4. Single-family House (Buildings less than 6th floor, only a single owner)</option>
                          <option>5. Business Office</option>
                          <option>6. Store</option>
                          <option>7. Suite</option>
                          <option>8. Factory</option>
                          <option>9. Other</option>
                        </select>
                      </div>
                    </div>
  
                    <div class="line"></div>
                    <div class="form-group row">
                      <label class="col-sm-4 form-control-label">Construction Materials</label>
                      <div class="col-sm-8 mb-3">
                        <select id="idBuildingMaterialSelect" name="building_material" class="form-control  text-small">
                          <option>RC (Reinforced Concrete)</option>
                          <option>Brick</option>
                        </select>
                      </div>
                    </div>
                    
                    <div class="line"></div>
                    <div class="form-group row">
                      <label class="col-sm-4 form-control-label">Other</label>
                      <div class="col-sm-8">
                        <div>
                          <input id="idHOMInput" type="checkbox" value="">
                          <label for="idHOMInput">with building management</label>
                        </div>
                        <div>
                          <input id="idHCInput" type="checkbox" value="">
                          <label for="idHCInput">with compartments</label>
                        </div>
                        <div>
                          <input id="idHAInput" type="checkbox" value="">
                          <label for="idHAInput">with additions</label>
                        </div>
                      </div>
                    </div>
                    <div class="line"></div>
                    <div class="form-group row">
                      <div class="col-md-3 offset-md-9">
                          <button id="idDemoBtn" class="btn btn-danger">Demo</button>
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-md-3 offset-md-9">
                        <button id="idEvaluateBtn" class="btn btn-danger">Evaluate</button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
    
            <div class="col-md-7">
              <div class="card">
                <div class="card-header d-flex align-items-center">
                  <h3>Value Forecast: The Price Evaluation</h3>
                </div>
                <div class="card-body">
                  <div class="row d-flex">
                    <div class="col-lg-12">


                      <div class="card">
                        <div class="row">
                          <div class="col-md-6">
                            <h2>Evaluated Price $</h2>
                            <p class="text-small">Based on XGBoost model</p>
                          </div>
                          <div class="col-md-6"><h2 id="id_price_h2">0<font class="text-small" style="color:black;">/Ping</font></h2></div>
                        </div>
                      </div>

                      <div class="card">
                        <h2>Feature Importances</h2>
                        <p class="text-small"> List the importance of the feature effecting the price</p>
                        <div class="col-md-12 pie-chart ">
                          <canvas id="featureImpPieChart" > </canvas>
                        </div>
                      </div>


                      <div class="card">
                        <h2>Key Features</h2>
                        <p class="text-small"></p>
                        <p class="text-small"></p>
                        <div class="row">

                          <div class="col-md-6">
                            <div class="wrapper count-title d-flex text-center">
                              <div class="name"><strong class="text-uppercase">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Average Price</strong><br><span class="text-small">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in the top 8 nearest records</span>
                                <div class="count-number"><font id="idAvgPriceFont" class="disc_stat_font">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</font></div>
                              </div>
                            </div>
                          </div>

                          <div class="col-md-6">
                            <div class="wrapper count-title d-flex text-center">
                              <div class="name"><strong class="text-uppercase">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Average Income</strong><br/><span class="text-small">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at the village</span>
                                <div class="count-number"><font id="idAvgIncomeFont" class="disc_stat_font">&nbsp;&nbsp;0</font></div>
                              </div>
                            </div>
                          </div>

                          <div class="col-md-6">
                            <div class="wrapper count-title d-flex text-center">
                              <div class="name"><strong class="text-uppercase">Distance to nearest MRT</strong><span class="text-small">unit: meters</span>
                                <div class="count-number"><font id="idDistMrtFont" class="disc_stat_font">0</font></div>
                              </div>
                            </div>
                          </div>

                          <div class="col-md-6">
                            <div class="wrapper count-title d-flex text-center">
                              <div class="name"><strong class="text-uppercase">Number of Bus Station</strong><br/><span class="text-small">in 100m</span>
                                <div class="count-number"><font id="idBusStationFont" class="disc_stat_font">0</font></div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </div>
      </div>

      <div id="id_map"></div>
      <div id="id_html_table"></div>
      <!-- Header Section-->
      <section class="dashboard-header section-padding">
        <div class="container-fluid">
          <div class="row d-flex align-items-md-stretch">

            <!-- Line Chart -->
            <div class="col-md-6">
              <div class="card sales-report">
                <h2 class="display h4"><strong>Fitting Trend of XGBoost Model</strong></h2>
                <p> XGboost performs quite well on predicting house price.<br>
                      Red points represents the actual price, while black points represent predicted price.<br> 
                      xAxes is data index and yAxes is ln(price).</p>
                <img width="500" src="{% static 'evaluator\img/fitting_plot_subtotal_log_divid_m2.png' %}">
              </div>
            </div>
            <!-- Line Chart -->
            <div class="col-md-6">
              <div class="card sales-report">
                <h2 class="display h4"><strong>Accuracy of XGBoost Model</strong></h2>
                <p>Our model successfully predicts 
                  90% of testing data with less than 30% error,
                  80% of testing data with less than 20% error,
                  50% of testing data with less than 10% error.</p>
                  <canvas id="accuracyLineChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </section>
      <div class="container">
        <div class="py-5 text-center">
            <!-- <img class="d-block mx-auto mb-4" src="./index_files/bootstrap-solid.svg" alt="" width="72" height="72"> -->
          <span style="font-size:1.0cm;"><strong>NLPist</strong></span>
          <p class="desc_p"><strong>AI Solution Team from Taiwan<br><br>Ming-Hsien Tsai / Hsuan-Chung Wang / Sun-Ting Lee</strong></p>
          <br><p>+886 972 220505 / milas81617@gmail.com</p>
        </div>
      </div>
      <footer class="main-footer">
        <div class="container-fluid">
          <div class="row">
            <div class="col-sm-6">
              <p>Copyright &copy; 2018-2019 NLPist | All rights reserved.</p>
            </div>
            <div class="col-sm-6 text-right">
              <p>Designed by <a href="https://bootstrapious.com" class="text-info">Bootstrapious</a></p>
              <!-- Please do not remove the backlink to us unless you support further theme's development at https://bootstrapious.com/donate. It is part of the license conditions and it helps me to run Bootstrapious. Thank you for understanding :)-->
            </div>
          </div>
        </div>
      </footer>
    </div>
    <!-- JavaScript files-->
    <script src="{% static 'evaluator/vendor/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'evaluator/vendor/popper.js/umd/popper.min.js' %}"></script>
    <script src="{% static 'evaluator/vendor/bootstrap/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'evaluator/js/grasp_mobile_progress_circle-1.0.0.min.js' %}"></script>
    <script src="{% static 'evaluator/vendor/jquery.cookie/jquery.cookie.js' %}"></script>
    <script src="{% static 'evaluator/vendor/chart.js/Chart.min.js' %}"></script>
    <script src="{% static 'evaluator/vendor/jquery-validation/jquery.validate.min.js' %}"></script>
    <script src="{% static 'evaluator/vendor/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js' %}"></script>
    <script src="{% static 'evaluator/js/charts-home.js' %}"></script>
    <!-- Main File-->
    <script src="{% static 'evaluator/js/front.js' %}"></script>
    <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"
    integrity="sha512-tAGcCfR4Sc5ZP5ZoVz0quoZDYX5aCtEm/eu1KhSLj2c9eFrylXZknQYmxUssFaVJKvvc0dJQixhGjG2yXWiV9Q=="
    crossorigin=""></script>
    <script>
        var mymap = L.map('id_map').setView([25.0375465,121.562244], 14);
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
          attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery ¬© <a href="https://www.mapbox.com/">Mapbox</a>',
          maxZoom: 18,
          id: 'mapbox.streets',
          accessToken: 'pk.eyJ1IjoiamVyZW15NDU1NSIsImEiOiJjamt6MjRvdWwwcG93M3ZtdGRkMXJlYjRyIn0.6SQzceRZS8aF6JHXBqFUyA'
      }).addTo(mymap);

      var ctx = document.getElementById('featureImpPieChart').getContext('2d');
      var myBarChart = new Chart(ctx, {
        type: 'horizontalBar',
        data:  {
                  labels: ["Square Feet", "Average Price", "House Age", "MRT Distance", "Number of Bus Station in 100m", "Building Type - Thorough", "Having Compartment"],
                  datasets: [{
                      label: "Feature Importance",
                      backgroundColor: [
                        'rgb(255, 99, 132)',
                        'rgb(255, 99, 132)',
                        'rgb(255, 99, 132)',
                        'rgb(255, 99, 132)',
                        'rgb(255, 99, 132)',
                        'rgb(255, 99, 132)',
                        'rgb(255, 99, 132)',
                      ],
                      //borderColor: 'rgb(255, 99, 132)',
                      data: [13819, 11165, 8299, 8196, 7264, 1772, 1602],
                  }]
              },
        options: {
          scales: {
            xAxes: [{
              scaleLabel: {
                display: true,
                labelString: 'F score',
              }
            }],
          },
          legend: {
              display: false
          },
        }
      });

      var ctx = document.getElementById('accuracyLineChart').getContext('2d');
      var myLineChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels:["0.1", "0.2", "0.3", "0.4", "0.5", "0.6", "0.7", "0.8", "0.9", "1.0"],
            datasets: [{
              backgroundColor: '#2da2fc',
                data:[40.9, 23.7, 14.9, 6.8, 4.6, 3.7, 2.2, 0.8, 0.6, 0.3],
            }]
        },
          options: {
            scales: {
              xAxes: [{
                scaleLabel: {
                  display: true,
                  labelString: 'predict error percentage',
                }
              }],
              yAxes: [{
                scaleLabel: {
                  display: true,
                  labelString: 'data percentage'
                }
              }]
            },
            legend: {
                display: false
            },
          }
      });


      //'address': 'Ëá∫ÂåóÂ∏ÇÂÖßÊπñÂçÄÊ∞ëÊ¨äÊù±Ë∑ØÂÖ≠ÊÆµ296Â∑∑1Ëôü',
      //'‰∏ªË¶ÅÂª∫Êùê': 'ÈãºÁ≠ãÊ∑∑ÂáùÂúüÈÄ†',
      //'‰∏ªË¶ÅÁî®ÈÄî': '‰ΩèÂÆ∂Áî®',
      //'‰∫§ÊòìÂπ¥ÊúàÊó•': 0103-10-20,
      //'ÂúüÂú∞ÁßªËΩâÁ∏ΩÈù¢Á©ç(Âπ≥ÊñπÂÖ¨Â∞∫)': 20.07,
      //'Âª∫Áâ©ÂûãÊÖã': '‰ΩèÂÆÖÂ§ßÊ®ì(11Â±§Âê´‰ª•‰∏äÊúâÈõªÊ¢Ø)',
      //'Âª∫ÁØâÂÆåÊàêÂπ¥Êúà': 0085-06-28,
      //'Âª∫Áâ©ÁèæÊ≥ÅÊ†ºÂ±Ä-ÈöîÈñì': 'Êúâ',
      //'ÊúâÁÑ°ÁÆ°ÁêÜÁµÑÁπî': 'Êúâ',
      //'ÈÉΩÂ∏ÇÂúüÂú∞‰ΩøÁî®ÂàÜÂçÄ': '‰Ωè',

      $("#idDemoBtn").click(function(e){
        e.preventDefault()
        $("#idAddressInput").val('Ëá∫ÂåóÂ∏ÇÂÖßÊπñÂçÄÊ∞ëÊ¨äÊù±Ë∑ØÂÖ≠ÊÆµ296Â∑∑1Ëôü')
        $("#idPingInput").val((20.07*0.3025).toString())
        $("#idHouseAgeInput").val(5)
        $("#idUsageSelect").find('option').eq(0).attr("selected", "selected")
        $("#idBuildingTypeSelect").find('option').eq(0).attr("selected", "selected")
        $("#idBuildingMaterialSelect").find('option').eq(0).attr("selected", "selected")
        $("#idHOMInput").attr("checked", "checked")
        $("#idHCInput").attr("checked", "checked")
        $("#idHAInput").attr("checked", "checked")
      })

      $("#idEvaluateBtn").click(function(e){
        e.preventDefault()
        address = $("#idAddressInput").val()
        total_area_m2 = Number($("#idPingInput").val()) / 0.3025
        house_year = $("#idHouseAgeInput").val()
        usage = $("#idUsageSelect").val()
        building_type = $("#idBuildingTypeSelect").val()
        building_material = $("#idBuildingMaterialSelect").val()
        having_origanizational_management = $("#idHOMInput").attr("checked") == "checked"
        having_compartment = $("#idHCInput").attr("checked") == "checked"
        haveing_addition = $("#idHAInput").attr("checked") == "checked"
        //ÂñÆÂÉπ: 107118.0
        //È†êÊ∏¨ÂÉπÊ†º: 107118.0
        postData = {
          "address":address,
          "total_area_m2":total_area_m2,
          "house_year":house_year,
          "usage":usage,
          "building_type":building_type,
          "building_material":building_material,
          "having_origanizational_management":having_origanizational_management,
          "having_compartment":having_compartment,
          "haveing_addition":haveing_addition,
        }

        document.body.style.cursor = "wait";
        $.ajax({
          type: 'POST',
          url: "{% url 'evaluate' %}",               
          cache: false,  
          data: postData,
          success: function(data){
            console.log("success!!!")
            document.getElementById("id_price_h2").innerHTML = data['price']+ '<font class="text-small" style="color:black;">/Ping</font>'
            document.getElementById("idAvgPriceFont").innerHTML = data['avg_price']
            document.getElementById("idAvgIncomeFont").innerHTML = data['avg_income']
            document.getElementById("idDistMrtFont").innerHTML = data['station_distance']
            document.getElementById("idBusStationFont").innerHTML = data['num_bus_stations']
            document.getElementById("id_html_table").innerHTML = data['nearest_points_table']

            mymap.setView(data['target_coordinate'], 18);
            data['nearest_points_coordinates'].forEach(function(v, i){
              console.log(v)
              L.marker(v).addTo(mymap)
              .bindPopup(i.toString())
              .openPopup();
            })
            document.body.style.cursor = "default";
          },
          error: function(){
            console.log("error!!!")
          },
          statusCode: {
            404: function() {
              alert("page not found");
            }
          }
        });
      })
      



    </script>  
  </body>
</html>